Project: Preliminary_Operations

Preliminary_Operations is a Matlab Project with the programs required to setup 
for the program to build and fix the MODIS, Aqua L2 SST fields in us-west-2. 
There four programs:

1) generate_weights_for_fast_regridding - generate the weights and locations 
for fast regridding. This only needs to be done once. Done for orbit scan lines 
11051 and 31191 on orbit with starting granule: AQUA_MODIS.20100701T022008.L2.SST. 
Should use 31191 result, which I have put in the Data directory. 

2) rewrite_original_sst_file_nccopy.m - copies a subset of variables from 
files generated by the Ocean Biology Processing Group and served from 
https://oceancolor.gsfc.nasa.gov/cgi/browse.pl?sen=amod to a new netCDF 
file. Variables copied are: year, day, msec, slon, slat, clon, clat, elon,  
elat, csol_z, sst, sstref, qual_sst, flags_sst and tilt. The most important 
of these is flags_sst, which is needed to fix the quality mask. The name of 
the output file is the same as that of the input file with '_original.nc4' 
replacing '.nc' at the end of the OBPG file. This program must be run on 
all OBPG files and the results moved to S3 when ready to generate fixed 
orbits.

3) get_nadir_info.m - This function reads the nadir lat, lon locations for 
all granules in a month and saves the information need to contruct full 
orbit files starting at descending 78 S. This program must be run prior to 
the program that reads all of the lats, lons, sst,... for an orbit and then
fixes various problems.

4) generate_separations_and_angles - This script generates the pixel 
separations in the along-scan and along-track direction at every pixel 
location on an orbit and, at each pixel location, it also generates the 
anlge that in the along-scan direction counterclockwise from east. The 
positive direction of the scan vector is taken as the direction in which 
the sensor is scanning. Also included in the output file is the angle, 
counterclockwise from east of the along-track direction. The positive 
along-track vector is the direction in which the satellite is moving. Use
this angle when recasting gradients as eastward and northward. 

The results are written to: 
fi_seps_and_angs = '~/Dropbox/ComputerPrograms/MATLAB/Projects/Build_Fixed_Orbital_Files/Data/Separation_and_Angle_Arrays.n4';

Use the following formulae to calculate eastward and northward gradients for
the test orbit: 
fi_test_orbit = '~/Dropbox/ComputerPrograms/MATLAB/Projects/Preliminary_Operations/Data/AQUA_MODIS.20100601T021010.L2.SST.nc4';

sst = ncread(fi_test_orbit, 'regridded_sst');
[grad_at_per_pixel, grad_as_per_pixel] = Sobel(sst);

along_scan_seps_array = ncread( fi_seps_and_angs, 'along_scan_seps_array');
along_track_seps_array = ncread( fi_seps_and_angs, 'along_track_seps_array');

[grad_at_per_km, grad_as_per_km, grad_mag_per_km] = ...
sobel_gradient_degrees_per_kilometer(sst, along_track_seps_array, along_scan_seps_array);

track_angle = ncread( fi_seps_and_angs, 'track_angle');            

grad_lon_per_km = grad_at_per_km .* cosd(track_angle) - grad_as_per_km .* sin(track_angle);
grad_lat_per_km = grad_at_per_km .* sind(track_angle) + grad_as_per_km .* cosd(track_angle);

5) diagnostic_plotter - Generates plots based on the test orbit (fi_test_orbit)
